language: python
python:
  - '3.7'

dist: xenial
jobs:
before_install:
  - sudo apt-get install build-essential libsystemd-dev dbus
install:
  - "./.ci/install-devtools.sh"
  - pip3 install -r dev-requirements.txt
  - pip3 install -r wrappers/python/requirements.txt
script:
  - "./.ci/build.sh"
  - pip3 install wrappers/python/dist/*.whl

deploy:
  - provider: pypi
    user: wirepas
    server: https://test.pypi.org/legacy/
    password:
      secure: JTfaa3FCh5l+uLVNwn2RAt7tbmoJ0A4b5E4uUx7alk1/D29ZM6CiXg0PhQs8MzT/MrUTkfuIgKQGhlDml3sUigaqBusoNjAfKd1yLtRRns53r54qztRPhCPJTkbR2M5+6GyRRY5Dhz4eTep3H35a4YFZqnmhPZX7cGnp9XzI6ykvXR0OX38RcqlaqOmVfn8GtTyKRdiXXa1sHTdHhBHTa+BFRoKU1NUHARuj/FPu5TD/cTjd7ZDsBGjSBtywveJZA2RFDaapqOI80Yj2HmwNirIgLoAODbZUAtVbESiz+NtXquX0zLQbUWHIwB6eKnqxNnXdF3VGbkeKHdRjRwxS6SIthMDruOOzKpWLij6KaIuubZ8gKP73T7qSu42l/Wp+voi6FrvJrUqLbXVMGw1W+XWrPqAu7LfBN3Crfv1JhTqwMz1bJeepuk2f8msGH8KpY7fnqbLN1CPTW5iLcst/9BjB3cZ7lKB/8adOPwNFZDf5onywHwsF/e7oNuBC10F54YMU5C1l2xI3ZJdot4rzVMqWBGfisAsZtrpVJ+x4ubXp15r4bcWUwVwvyN08PSjLMk9gFioPdEzFGCgYhp2LdMBJ6SDLjZOGrFEQv2z2UiqGyBeyJs9YSVL0R6s5HaFEpthv03MY0vTEcL2gI9IiaTSDv89CYGClK7AvZWHe+YI=
    skip_existing: true
    skip_cleanup: true
    on:
      tags: true
      branch: master

  - provider: releases
    api_key:
      secure: raSLK4E2IhWVsVj0RQ2VM1Fw/xPxFR4xiPRY+2DtU/4Pu7accMMVlO8eBjPH0GekVb0aTERfnh4fPTUG6T5fpQxLbawAnNJFkhvepZxH1EeClKvNvgthazEjlAdRMu1SfOpn/1+qKwyUx6tLbINPSwfM9Ait1uOZWJXJLnraQwubsF0lmW9LHoevwSV841grQG2wUI/oCi4bFSyQhXw6e/sU2alXigQ47YAXdgRyr3uAmj59F4AzTDVdFMLX8S6i5k+6xKRriqkHadmiGNEJHTK1qkR9bHDDIQR6nBFDXiV5UNNveS3q59xolPoAu9moljMODtR8t8CeIQ5dSlxjVZgMXE/qnuOmwMlXwQpTbYUux5m2XK5QWtz+PUFEFjdKMOdPkWHyUaBYWjdhk2z6aEHaKZjtzXhxbMyOds1U3vIeMhSnOvrH6OPFfgRL/KJuitY2gqyp4cRrH8lQr7PmcTCB+wjFhHBaEErHOp5y8775DW41ptFzYI1aavdnM4+2JGptRCDW6EMSt+pqVKdIZjpjmPK24VZPpTwo/mjBdYLEiR3HT+Ko5tzNDWdlHFFwK6JCgHIgCn5NWI13eVPq5mxCG+Ct6H4YJCpLTkwMT9U35r2UB1u8xBp5qNK7UInbjI6Vtt7PQqhPLDMZtYBlcOxjlpyZ4oOxu3dqj4QY3gc=
    file: wrappers/python/dist/ TO UPLOAD
    skip_cleanup: true
    draft: tag ~= /^v([0-9.]+)$rc([0-9]+)/
    on:
      tags: true
      branch: master

